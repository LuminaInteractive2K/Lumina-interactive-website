<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biometric Identity Portraits - Interactive Demo</title>
    <style>
        :root {
            --primary: #ff6b6b;
            --secondary: #4ecdc4;
            --accent: #ffe66d;
            --background: #1a1a2e;
            --text: #e0e0fc;
            --panel: rgba(26, 26, 46, 0.9);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        header {
            padding: 1rem 2rem;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            position: relative;
        }
        
        .visualization {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .portrait-container {
            position: relative;
            width: 60vh;
            height: 80vh;
            max-width: 80%;
            max-height: 80%;
            z-index: 5;
        }
        
        .side-panel {
            width: 350px;
            background-color: var(--panel);
            padding: 1.5rem;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            z-index: 10;
        }
        
        .panel-section {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .biometric-indicator {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .indicator-icon {
            font-size: 1.5rem;
        }
        
        .indicator-details {
            flex: 1;
        }
        
        .indicator-label {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .indicator-value {
            font-size: 1.1rem;
            color: var(--secondary);
        }
        
        .indicator-trend {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .visualization-style {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .style-label {
            flex: 1;
        }
        
        .style-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        #styleAbstract { background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); }
        #styleGeometric { background: repeating-linear-gradient(45deg, #ff6b6b, #ff6b6b 5px, #4ecdc4 5px, #4ecdc4 10px); }
        #styleFluid { background: radial-gradient(circle, #ff6b6b, #4ecdc4); }
        #styleTextured { background-image: url('data:image/svg+xml,%3Csvg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M-1,1 l2,-2 M0,10 l10,-10 M9,11 l2,-2" stroke="%23ffe66d" stroke-width="1"/%3E%3C/svg%3E'); background-color: #1a1a2e; }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }
        
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: none;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: var(--panel);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
            text-align: center;
        }
        
        .modal-section {
            margin-bottom: 1.5rem;
        }
        
        .modal-section-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        .sensor-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .sensor-card {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }
        
        .sensor-card:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }
        
        .sensor-card.connected {
            border-color: var(--secondary);
        }
        
        .sensor-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .sensor-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .sensor-status {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 1s ease;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 107, 107, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .loading-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
            max-width: 400px;
            text-align: center;
        }
        
        .progress-bar {
            width: 300px;
            height: 6px;
            background-color: rgba(255, 107, 107, 0.1);
            border-radius: 3px;
            margin-top: 1rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column-reverse;
            }
            .side-panel {
                width: 100%;
                height: 300px;
                border-left: none;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                overflow-x: auto;
                flex-direction: row;
                gap: 2rem;
            }
            .panel-section {
                min-width: 250px;
            }
            .portrait-container {
                width: 80vw;
                height: 60vh;
            }
        }
        
        @media (max-width: 600px) {
            header {
                padding: 0.75rem 1rem;
            }
            .logo {
                font-size: 1.2rem;
            }
            .side-panel {
                height: 250px;
                padding: 1rem;
            }
            .panel-title {
                font-size: 1rem;
            }
            .biometric-indicator {
                padding: 0.5rem;
                gap: 0.5rem;
            }
            .indicator-icon {
                font-size: 1.2rem;
            }
            .indicator-value {
                font-size: 1rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Initializing Biometric Identity Portrait</div>
        <div class="loading-subtext">Loading visualization engine and biometric models...</div>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <div class="logo">BIOMETRIC IDENTITY PORTRAITS</div>
            <div class="btn-group">
                <button class="btn btn-secondary" id="helpBtn">Help</button>
                <button class="btn" id="connectBtn">Connect Sensors</button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="visualization">
                <div class="portrait-container">
                    <canvas id="canvas"></canvas>
                </div>
            </div>
            
            <div class="side-panel">
                <div class="panel-section">
                    <div class="panel-title">Real-time Biometrics</div>
                    <div class="biometric-indicator">
                        <div class="indicator-icon">❤️</div>
                        <div class="indicator-details">
                            <div class="indicator-label">Heart Rate</div>
                            <div class="indicator-value" id="hrValue">72 bpm</div>
                            <div class="indicator-trend" id="hrTrend">Stable</div>
                        </div>
                    </div>
                    <div class="biometric-indicator">
                        <div class="indicator-icon">⚡</div>
                        <div class="indicator-details">
                            <div class="indicator-label">Skin Conductance</div>
                            <div class="indicator-value" id="gsrValue">1.5 µS</div>
                            <div class="indicator-trend" id="gsrTrend">Slightly increasing</div>
                        </div>
                    </div>
                    <div class="biometric-indicator">
                        <div class="indicator-icon">😊</div>
                        <div class="indicator-details">
                            <div class="indicator-label">Facial Expression</div>
                            <div class="indicator-value" id="faceValue">Neutral</div>
                            <div class="indicator-trend" id="faceTrend">Calm</div>
                        </div>
                    </div>
                    <div class="biometric-indicator">
                        <div class="indicator-icon">🧠</div>
                        <div class="indicator-details">
                            <div class="indicator-label">Brainwaves (Alpha)</div>
                            <div class="indicator-value" id="eegValue">65%</div>
                            <div class="indicator-trend" id="eegTrend">Relaxed focus</div>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-title">Visualization Style</div>
                    <div class="visualization-style">
                        <span class="style-label">Abstract Flow</span>
                        <div class="style-preview" id="styleAbstract"></div>
                        <input type="radio" name="vizStyle" value="abstract" checked style="margin-left: 0.5rem;">
                    </div>
                    <div class="visualization-style">
                        <span class="style-label">Geometric Patterns</span>
                        <div class="style-preview" id="styleGeometric"></div>
                        <input type="radio" name="vizStyle" value="geometric" style="margin-left: 0.5rem;">
                    </div>
                    <div class="visualization-style">
                        <span class="style-label">Fluid Dynamics</span>
                        <div class="style-preview" id="styleFluid"></div>
                        <input type="radio" name="vizStyle" value="fluid" style="margin-left: 0.5rem;">
                    </div>
                    <div class="visualization-style">
                        <span class="style-label">Textured Layers</span>
                        <div class="style-preview" id="styleTextured"></div>
                        <input type="radio" name="vizStyle" value="textured" style="margin-left: 0.5rem;">
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-title">Portrait Controls</div>
                    <div class="btn-group" style="flex-direction: column; gap: 0.75rem;">
                        <button class="btn btn-secondary" id="snapshotBtn">Take Snapshot</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset Portrait</button>
                        <button class="btn btn-secondary" id="exportBtn">Export Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="connectModal">
        <div class="modal-content">
            <button class="close-modal" id="closeConnectModal">×</button>
            <h2 class="modal-title">Connect Biometric Sensors</h2>
            
            <div class="modal-section">
                <h3 class="modal-section-title">Available Sensors</h3>
                <p>Select the sensors you want to connect:</p>
                
                <div class="sensor-list">
                    <div class="sensor-card connected" data-sensor="hr">
                        <div class="sensor-icon">❤️</div>
                        <div class="sensor-name">Heart Rate Monitor</div>
                        <div class="sensor-status">Connected (Polar H10)</div>
                    </div>
                    <div class="sensor-card" data-sensor="gsr">
                        <div class="sensor-icon">⚡</div>
                        <div class="sensor-name">GSR Sensor</div>
                        <div class="sensor-status">Not Connected</div>
                    </div>
                    <div class="sensor-card connected" data-sensor="face">
                        <div class="sensor-icon">😊</div>
                        <div class="sensor-name">Webcam (Facial)</div>
                        <div class="sensor-status">Connected (Built-in)</div>
                    </div>
                    <div class="sensor-card" data-sensor="eeg">
                        <div class="sensor-icon">🧠</div>
                        <div class="sensor-name">EEG Headset</div>
                        <div class="sensor-status">Not Connected</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-section" style="text-align: center;">
                <button class="btn" id="startConnectionBtn">Update Connections</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <button class="close-modal" id="closeHelpModal">×</button>
            <h2 class="modal-title">Biometric Identity Portraits Help</h2>
            
            <div class="modal-section">
                <h3 class="modal-section-title">About</h3>
                <p>Biometric Identity Portraits create a living, evolving digital representation of you, generated in real-time from your unique biological data. Watch as your inner state is translated into a beautiful, abstract artwork.</p>
            </div>
            
            <div class="modal-section">
                <h3 class="modal-section-title">Biometric Inputs</h3>
                <ul style="margin-left: 1.5rem; line-height: 1.6;">
                    <li><strong>Heart Rate (HR):</strong> Influences rhythmic patterns and pulse-like effects.</li>
                    <li><strong>Skin Conductance (GSR):</strong> Affects color intensity and emotional expression.</li>
                    <li><strong>Facial Expression:</strong> Shapes the overall composition and mood.</li>
                    <li><strong>Brainwaves (EEG):</strong> Modulates complexity and texture (requires EEG headset).</li>
                </ul>
            </div>
            
            <div class="modal-section">
                <h3 class="modal-section-title">Visualization Styles</h3>
                <p>Choose how your biometric data is visually interpreted:</p>
                <ul style="margin-left: 1.5rem; line-height: 1.6;">
                    <li><strong>Abstract Flow:</strong> Smooth, flowing colors and shapes.</li>
                    <li><strong>Geometric Patterns:</strong> Structured, crystalline formations.</li>
                    <li><strong>Fluid Dynamics:</strong> Liquid-like movements and interactions.</li>
                    <li><strong>Textured Layers:</strong> Rich, layered textures and organic forms.</li>
                </ul>
            </div>
            
            <div class="modal-section">
                <h3 class="modal-section-title">Connecting Sensors</h3>
                <p>Use the "Connect Sensors" button to manage connections to compatible biometric devices. The system supports standard Bluetooth sensors, webcams, and various EEG headsets. Simulation mode is active if no sensors are connected.</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simplex-noise@3.0.0/dist/simplex-noise.min.js"></script>
    <script>
        let scene, camera, renderer, portraitMesh, noise;
        let lastFrameTime = 0;
        let time = 0;
        
        // Simulated biometric data
        let bioData = {
            hr: 72,
            gsr: 1.5,
            face: { valence: 0, arousal: 0 }, // Neutral
            eegAlpha: 65
        };
        
        let currentStyle = 'abstract';
        
        function init() {
            noise = new SimplexNoise();
            initThreeJS();
            initPortrait();
            initEventListeners();
            simulateLoading();
            animate();
            simulateBiometricChanges();
        }
        
        function initThreeJS() {
            const container = document.getElementById('canvas').parentNode;
            scene = new THREE.Scene();
            
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 5;
            
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 0.8);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);
            
            window.addEventListener('resize', onWindowResize);
        }
        
        function initPortrait() {
            const geometry = new THREE.SphereGeometry(2, 64, 64);
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0.0 },
                    hr: { value: bioData.hr },
                    gsr: { value: bioData.gsr },
                    valence: { value: bioData.face.valence },
                    arousal: { value: bioData.face.arousal },
                    eegAlpha: { value: bioData.eegAlpha },
                    styleType: { value: 0.0 } // 0: abstract, 1: geometric, 2: fluid, 3: textured
                },
                vertexShader: `
                    uniform float time;
                    uniform float hr;
                    uniform float gsr;
                    uniform float valence;
                    uniform float arousal;
                    uniform float eegAlpha;
                    varying vec3 vNormal;
                    varying vec2 vUv;
                    
                    // Simplex noise function (requires inclusion)
                    // Using a placeholder here
                    float snoise(vec3 p) {
                        return sin(p.x * 10.0 + time) * cos(p.y * 10.0 + time) * sin(p.z * 10.0 + time);
                    }
                    
                    void main() {
                        vNormal = normal;
                        vUv = uv;
                        vec3 pos = position;
                        
                        float hrFactor = (hr - 60.0) / 40.0; // Normalize HR around 60-100 bpm
                        float gsrFactor = clamp(gsr / 5.0, 0.0, 1.0); // Normalize GSR 0-5 uS
                        float alphaFactor = eegAlpha / 100.0;
                        
                        // Base shape modulation
                        float displacement = snoise(pos * (1.0 + alphaFactor * 2.0) + time * 0.5) * 0.1;
                        
                        // Heartbeat pulse effect
                        displacement += sin(time * (hr / 60.0) * 3.14159 * 2.0) * 0.05 * (1.0 + arousal);
                        
                        // GSR influence on surface complexity
                        displacement += snoise(pos * 5.0 * (1.0 + gsrFactor) + time) * 0.05 * gsrFactor;
                        
                        pos += normal * displacement;
                        
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform float time;
                    uniform float hr;
                    uniform float gsr;
                    uniform float valence;
                    uniform float arousal;
                    uniform float eegAlpha;
                    uniform float styleType;
                    varying vec3 vNormal;
                    varying vec2 vUv;
                    
                    // Simplex noise function (placeholder)
                    float snoise(vec2 p) {
                        return sin(p.x * 10.0 + time) * cos(p.y * 10.0 + time);
                    }
                    
                    vec3 hsv2rgb(vec3 c) {
                        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
                        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
                        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
                    }

                    void main() {
                        float hrFactor = (hr - 60.0) / 40.0;
                        float gsrFactor = clamp(gsr / 5.0, 0.0, 1.0);
                        float alphaFactor = eegAlpha / 100.0;
                        
                        vec3 baseColor;
                        float pattern = 0.0;
                        
                        // Base hue influenced by valence (mood)
                        float hue = mix(0.6, 0.0, (valence + 1.0) / 2.0); // Blue (calm) to Red (agitated)
                        // Saturation influenced by arousal
                        float saturation = mix(0.5, 1.0, (arousal + 1.0) / 2.0);
                        // Value influenced by GSR (intensity)
                        float value = mix(0.7, 1.0, gsrFactor);
                        
                        if (styleType == 0.0) { // Abstract Flow
                            float noisePattern = snoise(vUv * 5.0 + vec2(time * 0.2, time * 0.1));
                            hue += noisePattern * 0.1;
                            saturation = clamp(saturation + noisePattern * 0.2, 0.3, 1.0);
                            value = clamp(value + noisePattern * 0.1, 0.5, 1.0);
                            baseColor = hsv2rgb(vec3(hue, saturation, value));
                        } else if (styleType == 1.0) { // Geometric Patterns
                            float grid = max(abs(sin(vUv.x * 20.0 * (1.0 + alphaFactor))), abs(cos(vUv.y * 20.0 * (1.0 + alphaFactor))));
                            pattern = smoothstep(0.8, 0.9, grid);
                            baseColor = hsv2rgb(vec3(hue, saturation * pattern, value));
                        } else if (styleType == 2.0) { // Fluid Dynamics
                            float fluidNoise = snoise(vUv * 3.0 + vec2(snoise(vUv + time * 0.1), snoise(vUv - time * 0.1)) * 0.5);
                            hue += fluidNoise * 0.2;
                            baseColor = hsv2rgb(vec3(hue, saturation, value));
                        } else { // Textured Layers
                            float textureNoise = snoise(vUv * 15.0 * (1.0 + gsrFactor));
                            value *= (0.8 + textureNoise * 0.2);
                            baseColor = hsv2rgb(vec3(hue, saturation, value));
                        }
                        
                        // Add lighting effect
                        float lighting = dot(vNormal, normalize(vec3(1.0, 1.0, 1.0))) * 0.5 + 0.5;
                        
                        gl_FragColor = vec4(baseColor * lighting, 1.0);
                    }
                `,
                side: THREE.DoubleSide
            });
            
            portraitMesh = new THREE.Mesh(geometry, material);
            scene.add(portraitMesh);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            time += 0.01;
            
            if (portraitMesh) {
                portraitMesh.material.uniforms.time.value = time;
                portraitMesh.material.uniforms.hr.value = bioData.hr;
                portraitMesh.material.uniforms.gsr.value = bioData.gsr;
                portraitMesh.material.uniforms.valence.value = bioData.face.valence;
                portraitMesh.material.uniforms.arousal.value = bioData.face.arousal;
                portraitMesh.material.uniforms.eegAlpha.value = bioData.eegAlpha;
                
                portraitMesh.rotation.y += 0.002;
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const container = document.getElementById('canvas').parentNode;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function initEventListeners() {
            // Style selection
            document.querySelectorAll('input[name="vizStyle"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentStyle = this.value;
                    if (portraitMesh) {
                        let styleValue = 0.0;
                        if (currentStyle === 'geometric') styleValue = 1.0;
                        else if (currentStyle === 'fluid') styleValue = 2.0;
                        else if (currentStyle === 'textured') styleValue = 3.0;
                        portraitMesh.material.uniforms.styleType.value = styleValue;
                    }
                });
            });
            
            // Modal buttons
            document.getElementById('connectBtn').addEventListener('click', () => {
                document.getElementById('connectModal').classList.add('active');
            });
            document.getElementById('closeConnectModal').addEventListener('click', () => {
                document.getElementById('connectModal').classList.remove('active');
            });
            document.getElementById('startConnectionBtn').addEventListener('click', () => {
                document.getElementById('connectModal').classList.remove('active');
                alert('Sensor connection management not implemented in this demo.');
            });
            
            document.getElementById('helpBtn').addEventListener('click', () => {
                document.getElementById('helpModal').classList.add('active');
            });
            document.getElementById('closeHelpModal').addEventListener('click', () => {
                document.getElementById('helpModal').classList.remove('active');
            });
            
            // Portrait controls
            document.getElementById('snapshotBtn').addEventListener('click', () => alert('Snapshot feature coming soon!'));
            document.getElementById('resetBtn').addEventListener('click', () => {
                // Reset simulation or visual state if needed
                time = 0; // Example reset
                alert('Portrait reset.');
            });
            document.getElementById('exportBtn').addEventListener('click', () => alert('Data export feature coming soon!'));
        }
        
        function simulateBiometricChanges() {
            setInterval(() => {
                // Simulate HR changes (60-100 bpm)
                bioData.hr += (Math.random() - 0.5) * 4;
                bioData.hr = Math.max(60, Math.min(100, bioData.hr));
                document.getElementById('hrValue').textContent = `${Math.round(bioData.hr)} bpm`;
                document.getElementById('hrTrend').textContent = Math.random() > 0.7 ? (Math.random() > 0.5 ? 'Increasing' : 'Decreasing') : 'Stable';
                
                // Simulate GSR changes (0.5 - 5 uS)
                bioData.gsr += (Math.random() - 0.5) * 0.5;
                bioData.gsr = Math.max(0.5, Math.min(5, bioData.gsr));
                document.getElementById('gsrValue').textContent = `${bioData.gsr.toFixed(1)} µS`;
                document.getElementById('gsrTrend').textContent = Math.random() > 0.6 ? (Math.random() > 0.5 ? 'Increasing' : 'Decreasing') : 'Stable';
                
                // Simulate Facial Expression changes (valence/arousal -1 to 1)
                bioData.face.valence += (Math.random() - 0.5) * 0.2;
                bioData.face.arousal += (Math.random() - 0.5) * 0.2;
                bioData.face.valence = Math.max(-1, Math.min(1, bioData.face.valence));
                bioData.face.arousal = Math.max(-1, Math.min(1, bioData.face.arousal));
                let mood = 'Neutral';
                if (bioData.face.valence > 0.3) mood = 'Positive';
                else if (bioData.face.valence < -0.3) mood = 'Negative';
                let energy = 'Calm';
                if (bioData.face.arousal > 0.3) energy = 'Energized';
                else if (bioData.face.arousal < -0.3) energy = 'Subdued';
                document.getElementById('faceValue').textContent = mood;
                document.getElementById('faceTrend').textContent = energy;
                
                // Simulate EEG Alpha changes (0-100%)
                bioData.eegAlpha += (Math.random() - 0.5) * 10;
                bioData.eegAlpha = Math.max(0, Math.min(100, bioData.eegAlpha));
                document.getElementById('eegValue').textContent = `${Math.round(bioData.eegAlpha)}%`;
                let focus = 'Mixed';
                if (bioData.eegAlpha > 70) focus = 'Relaxed';
                else if (bioData.eegAlpha < 30) focus = 'Alert';
                document.getElementById('eegTrend').textContent = focus;
                
            }, 1000);
        }
        
        function simulateLoading() {
            const loadingOverlay = document.querySelector('.loading-overlay');
            const progressFill = document.querySelector('.progress-fill');
            const loadingText = document.querySelector('.loading-text');
            const loadingSubtext = document.querySelector('.loading-subtext');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    loadingText.textContent = 'Biometric Portrait Ready';
                    loadingSubtext.textContent = 'Visualizing your inner state...';
                    
                    setTimeout(() => {
                        loadingOverlay.style.opacity = 0;
                        setTimeout(() => {
                            loadingOverlay.style.display = 'none';
                        }, 1000);
                    }, 500);
                }
                
                progressFill.style.width = `${progress}%`;
                
                if (progress > 30 && progress < 60) {
                    loadingSubtext.textContent = 'Loading shader programs...';
                } else if (progress >= 60 && progress < 90) {
                    loadingSubtext.textContent = 'Calibrating biometric mapping...';
                }
            }, 200);
        }
        
        window.addEventListener('load', init);
    </script>
</body>
</html>
